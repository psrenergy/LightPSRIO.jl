<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mixed Chart Example with Hourly and Monthly Data</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        #chart-container {
            width: 80%;
            height: 400px;
            margin: auto;
        }
    </style>
</head>

<body>
    <div id="chart-container">
        <canvas id="mixedChart"></canvas>
    </div>

    <script>
        // Utility functions (no imports/exports)
        // Use window.luxon.DateTime
        var _seed = Date.now();
        function srand(seed) {
            _seed = seed;
        }
        function rand(min, max) {
            min = (typeof min === 'number') ? min : 0;
            max = (typeof max === 'number') ? max : 0;
            _seed = (_seed * 9301 + 49297) % 233280;
            return min + (_seed / 233280) * (max - min);
        }
        function numbers(config) {
            var cfg = config || {};
            var min = cfg.min || 0;
            var max = cfg.max || 100;
            var from = cfg.from || [];
            var count = cfg.count || 8;
            var decimals = cfg.decimals || 8;
            var continuity = cfg.continuity || 1;
            var dfactor = Math.pow(10, decimals) || 0;
            var data = [];
            var i, value;
            for (i = 0; i < count; ++i) {
                value = (from[i] || 0) + rand(min, max);
                if (rand(0, 1) <= continuity) {
                    data.push(Math.round(dfactor * value) / dfactor);
                } else {
                    data.push(null);
                }
            }
            return data;
        }
        function transparentize(value, opacity) {
            var alpha = opacity === undefined ? 0.5 : 1 - opacity;
            // fallback: just use rgba with alpha
            var rgb = value.match(/\d+/g);
            if (rgb && rgb.length >= 3) {
                return `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${alpha})`;
            }
            return value;
        }
        const CHART_COLORS = {
            red: 'rgb(255, 99, 132)',
            orange: 'rgb(255, 159, 64)',
            yellow: 'rgb(255, 205, 86)',
            green: 'rgb(75, 192, 192)',
            blue: 'rgb(54, 162, 235)',
            purple: 'rgb(153, 102, 255)',
            grey: 'rgb(201, 203, 207)'
        };
        function newDate(days) {
            return window.luxon.DateTime.now().plus({ days: days }).toJSDate();
        }
        function newDateString(days) {
            return window.luxon.DateTime.now().plus({ days: days }).toISO();
        }

        // Generate hourly data for every hour of 2023, and monthly aggregated data for 2023
        srand(12345); // deterministic seed for reproducible demo data

        const hourly = [];
        let dt = window.luxon.DateTime.fromObject({ year: 2023, month: 1, day: 1, hour: 0 }, { zone: 'utc' });
        while (dt.year === 2023) {
            hourly.push({ x: dt.toISO(), y: Math.round(rand(0, 100)) });
            dt = dt.plus({ hours: 1 });
        }

        const monthly = [];
        for (let m = 1; m <= 12; m++) {
            // pick mid-month for display (15th)
            const d = window.luxon.DateTime.fromObject({ year: 2023, month: m, day: 15 }, { zone: 'utc' }).toISO();
            monthly.push({ x: d, y: Math.round(rand(0, 100)) });
        }

        const data = {
            datasets: [

                {
                    label: 'Monthly 2023',
                    data: monthly,
                    borderColor: CHART_COLORS.red,
                    backgroundColor: transparentize(CHART_COLORS.red, 0.6),
                    borderWidth: 2,
                    pointRadius: 4,
                    fill: false,
                },
                {
                    label: 'Hourly 2023',
                    data: hourly,
                    borderColor: CHART_COLORS.blue,
                    backgroundColor: transparentize(CHART_COLORS.blue, 0.4),
                    borderWidth: 1,
                    pointRadius: 0, // hide points for performance
                    fill: false,
                }
            ]
        };

        const config = {
            type: 'line',
            data: data,
            options: {
                plugins: {
                    title: {
                        text: 'Hourly and Monthly Data for 2023',
                        display: true
                    }
                },
                interaction: {
                    mode: 'nearest',
                    intersect: false
                },
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            tooltipFormat: 'DD T',
                            displayFormats: {
                                hour: 'MMM d HH:mm',
                                day: 'MMM d',
                                month: 'MMM yyyy'
                            }
                        },
                        title: {
                            display: true,
                            text: 'Date'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Value'
                        }
                    }
                }
            }
        };

        const ctx = document.getElementById('mixedChart').getContext('2d');
        new Chart(ctx, config);
    </script>
</body>

</html>